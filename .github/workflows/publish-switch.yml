name: Publish Switch

on:
  push:
    branches:
      - dev
      - master
      - release

permissions:
  id-token: write  # Required for OIDC trusted publishing
  contents: write  # Required for pushing version bumps back to repo

jobs:
  publish-dev:
    if: github.repository == 'twreporter/congress-dashboard-monorepo' && github.ref == 'refs/heads/dev'
    uses: ./.github/workflows/dev-version-bump.yml
    permissions:
      id-token: write
      contents: write

  publish-master:
    if: github.repository == 'twreporter/congress-dashboard-monorepo' && github.ref == 'refs/heads/master'
    uses: ./.github/workflows/master-version-bump.yml
    permissions:
      id-token: write
      contents: write

  publish-release:
    if: github.repository == 'twreporter/congress-dashboard-monorepo' && github.ref == 'refs/heads/release'
    uses: ./.github/workflows/release-version-bump.yml
    permissions:
      id-token: write
      contents: write